<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin User Details</title>
    <style>
      /* General Styling */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: Arial, sans-serif;
      }
  
      body {
          background-color: #f4f4f4;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
      }
  
      header {
          background-color: #333;
          color: white;
          padding: 20px;
          text-align: center;
          position: relative;
      }
  
      main {
          flex: 1;
          padding: 20px;
          max-width: 800px;
          margin: 0 auto;
          background: #fff;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
          overflow-x: auto; /* Enables horizontal scrolling */
      }
  
      h1 {
          text-align: center;
          margin-bottom: 20px;
      }
  
      table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
          min-width: 700px; /* Ensures the table doesn't shrink too much */
      }
  
      th, td {
          padding: 12px;
          border: 1px solid #ddd;
          text-align: left;
      }
  
      th {
          background-color: #333;
          color: white;
      }
  
      footer {
          background-color: #333;
          color: white;
          padding: 10px;
          text-align: center;
      }
  
      .back-btn {
          padding: 10px 20px;
          background-color: #50d890;
          color: white;
          border: none;
          border-radius: 50px;
          cursor: pointer;
          position: absolute;
          top: 50%;
          left: 20px;
          transform: translateY(-50%);
          transition: background-color 0.3s, box-shadow 0.3s;
      }
  
      .back-btn:hover {
          background-color: #45c77e;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }
  
      /* Media Queries for Smaller Screens */
      @media (max-width: 768px) {
          main {
              padding: 10px;
          }
  
          table {
              font-size: 14px; /* Adjust font size for smaller screens */
              min-width: 600px; /* Ensure table still fits in smaller width */
          }
  
          th, td {
              padding: 8px; /* Reduce padding for smaller screens */
          }
  
          h1 {
              font-size: 18px; /* Adjust header font size for mobile */
          }
  
          .back-btn {
              padding: 8px 16px;
              font-size: 14px;
          }
      }
  
      @media (max-width: 480px) {
          table {
              font-size: 12px;
              min-width: 500px; /* Further reduce table size for very small screens */
          }
  
          th, td {
              padding: 6px; /* Reduce padding further */
          }
  
          h1 {
              font-size: 16px;
          }
  
          .back-btn {
              padding: 6px 12px;
              font-size: 12px;
          }
      }
  </style>
  
</head>
<body>
    <header>
        <button class="back-btn" onclick="history.back()">Back</button>
        <h2>User Details</h2>
    </header>

    <main>
        <h1>All Registered Users</h1>

        <!-- User Details Table -->
        <table id="userDetailsTable">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Mobile</th>
                    <th>TRC-20 Balance</th>
                    <th>BEP-20 Balance</th>
                    <th>Processing Balance</th>
                    <th>Commission Balance</th>
                    <th>Created At</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be dynamically populated here -->
            </tbody>
        </table>
    </main>

    <footer>
        <p>&copy; 2024 Crypto Admin Panel. All rights reserved.</p>
    </footer>

    <script>
        // Fetch all registered users
        async function fetchAllUsers() {
            try {
                const response = await fetch("https://onexcrypto.xyz/api/admin/getAllUserDetails", {
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${localStorage.getItem("token")}`,
                    },
                });
                if (!response.ok) {
                    throw new Error("Error fetching user details");
                }
                const data = await response.json();
                const users = data.users;

                console.log("Users", users);
                displayUserDetails(users); // Pass the user data to display
            } catch (error) {
                console.error("Error fetching user details:", error);
                alert("Failed to fetch user details");
            }
        }

        // Display all users in a table
        function displayUserDetails(users) {
            const userDetailsTable = document.getElementById("userDetailsTable").getElementsByTagName('tbody')[0];

            users.forEach(user => {
                const row = userDetailsTable.insertRow();
                row.innerHTML = `
                    <td>${user._id}</td>
                    <td>${user.mobile}</td>
                    <td>${user.balances.trc20}</td>
                    <td>${user.balances.bep20}</td>
                    <td>${user.balances.processing || 0}</td>
                    <td>${user.balances.commission || 0}</td>
                    <td>${new Date(user.createdAt).toLocaleString()}</td>
                `;
            });
        }

        // Authenticate before loading data
        async function authenticateAndFetchDetails() {
            const token = localStorage.getItem("token");
            if (!token) {
                window.location.href = "admin-login.html";
                return false;
            }
            const response = await fetch("https://onexcrypto.xyz/api/verifyAdmin", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                },
            });
            const result = await response.json();
            if (!result.success) {
                window.location.href = "admin-login.html";
                return false;
            }
            fetchAllUsers(); // Fetch all users if authenticated
        }

        window.onload = authenticateAndFetchDetails;
    </script>
</body>
</html>
