<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/img/style.css">
    <title>Exchange USDT</title>
</head>
<style>
    /* Global Styles */
/* Global Styles */
body {
    font-family: 'Arial', sans-serif;
    background-color: #f9f9f9;
    color: #333;
    margin: 0;
    padding: 0;
}

a {
    text-decoration: none;
    color: inherit;
}

.main {
    padding: 20px;
}

/* Header Section */
.container-fluid {
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

.fw-bold {
    font-size: 1.1rem;
}

/* Bank Details Section */
.bank-details {
    padding: 20px;
    background-color: #f8f8f8;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
}

#addBankAccountButton {
    text-align: center;
    margin-top: 20px;
}

.usdl-button {
    display: inline-block;
    background-color: #343a40;
    color: #fff;
    padding: 12px 20px;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.usdl-button:hover {
    background-color: #23272b;
}

/* Network Selection */
.custom-radio-label {
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f1f1f1;
    padding: 10px 15px;
    border-radius: 8px;
    border: 2px solid transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem; /* Smaller font for radio button text */
}

.custom-radio-label:hover {
    background-color: #e2e2e2;
}

.custom-radio-label img {
    margin-right: 10px;
}

input[type="radio"]:checked + .custom-radio-label {
    border-color: #343a40;
    background-color: #e2e2e2;
}

/* Available Balance */
#availableBalance {
    font-size: 0.875rem; /* Smaller font for available balance text */
    font-weight: bold;
    color: #333;
}

.d-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* 1 USDT = ₹93 */
.d-flex span {
    font-size: 0.875rem; /* Smaller font for 1 USDT text */
}

/* Sell Amount Input */
input[type="text"] {
    width: 100%;
    border: none;
    outline: none;
    font-size: 1rem;
    color: #333;
    background-color: #f9f9f9;
    border-bottom: 2px solid #ddd;
    transition: border-bottom 0.3s ease;
}

input[type="text"]:focus {
    border-bottom: 2px solid #343a40;
}

/* Table Styles */
table.table {
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    border-collapse: separate;
}

table.table td, table.table th {
    padding: 10px 15px;
}

input.is-invalid {
    border-bottom: 2px solid red; /* Change border color to red */
}

table.table tr {
    border-bottom: 1px solid #ddd;
}

table.table tr:last-child {
    border-bottom: none;
}

table.table td.border-end {
    border-right: 1px solid #ddd;
}

table.table tr:hover {
    background-color: #f1f1f1;
}

/* Button Styles */
.button-usdt {
    background-color: #343a40;
    color: #fff;
    border: none;
    padding: 12px 20px;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.button-usdt:hover {
    background-color: #23272b;
}

/* Additional Paddings and Margins */
.container-fluid {
    padding: 0;
}

h6 {
    margin-bottom: 0;
}

p {
    margin-top: 5px;
}

.text-center p {
    font-size: 0.875rem;
    color: #6c757d;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .d-flex {
        flex-direction: column;
    }

    .custom-radio-label {
        flex-direction: column;
        padding: 8px;
        font-size: 0.75rem; /* Further reduced for smaller screens */
    }

    .table {
        font-size: 0.875rem;
    }

    .button-usdt {
        width: 100%;
    }
}

    </style>
<body>
    <div class="main">
        <div class="container-fluid">
            <div class="container">
                <div class="row">
                    <div class="col-12 d-flex justify-content-between p-2">
                        <div><a href="exchange.html"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M400-80 0-480l400-400 71 71-329 329 329 329-71 71Z"/></svg></a></div>
                        <div class="fw-bold fs-6">Exchange</div>
                        <div><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M480-120q-138 0-240.5-91.5T122-440h82q14 104 92.5 172T480-200q117 0 198.5-81.5T760-480q0-117-81.5-198.5T480-760q-69 0-129 32t-101 88h110v80H120v-240h80v94q51-64 124.5-99T480-840q75 0 140.5 28.5t114 77q48.5 48.5 77 114T840-480q0 75-28.5 140.5t-77 114q-48.5 48.5-114 77T480-120Zm112-192L440-464v-216h80v184l128 128-56 56Z"/></svg></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid bg-dark text-light">
            <div class="row">
                <div class="d-flex justify-content-between">
                    <div><img src="assets/img/ada.png" alt="" class="pt-2" width="30px"></div>
                    <div><h6 style="font-size: 14px; padding-top: 5px;">Angelx</h6><p class="" style="font-size: 12px;">Lorem ipsum dolor sit amet consectetur adipisicing elit.</p></div>
                    <div><svg xmlns="http://www.w3.org/2000/svg" class="mt-3" height="20px" viewBox="0 -960 960 960" width="24px" fill="#5f6368"><path d="M504-480 320-664l56-56 240 240-240 240-56-56 184-184Z"/></svg></div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="container">
                <div class="row pb-4">
                    <div id="bankDetailsContainer" class="bank-details"></div>
                    <div id="addBankAccountButton">
                        <a href="BankAccount.html" type="button" class="usdl-button" style="font-size: 12px;">
                            Add or Update Bank Account
                        </a>
                    </div>
                    <!-- Network Selection -->
                    <div class="row text-center justify-content-center mt-4">
                        <div class="col-5">
                            <input type="radio" id="bep" name="network" value="BSC" class="d-none">
                            <label for="bep" class="custom-radio-label">
                                <img src="assets/img/bep.jpeg" width="18px" alt="">
                                <span style="font-size: 7px;">BSC (BEP-20)</span>
                            </label>
                        </div>
                        <div class="col-5">
                            <input type="radio" id="trc" name="network" value="TRX" class="d-none">
                            <label for="trc" class="custom-radio-label">
                                <img src="assets/img/usdt.png" width="18px" alt="">
                                <span style="font-size: 7px;">TRX (TRC-20)</span>
                            </label>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-3">
                        <div><span id="availableBalance">Available: 0</span></div>
                        <div><span>1 USDT = ₹<span class="usdt-price"></span></span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="container">
                <p>Sell amount</p>
                <div class="d-flex justify-content-between">
                    <input type="text" id="amountInput" style="border: none; background-color: transparent; padding-left: 10px;" placeholder="Please enter the amount">
                    <span class="ps-3"><img src="assets/img/usdt.png" alt="" width="20px">USDT</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between mt-3">
                    <input type="password" id="txnPassword" style="border: none; background-color: transparent; padding-left: 10px;" placeholder="Transaction Password">
                </div>
                <p id="receivedAmount" style="font-size: 0.875rem; color: #333; font-weight: bold;"></p> <!-- Amount received will be displayed here -->
                <hr>
                <div class="text-center">
                    <table class="table mt-2">
                        <tbody class="p-2">
                            <tr>
                                <td class="border-end">&#8377; 500 - &#8377; 1000</td>
                                <td>&#8377;<span class="usdt-price"></span>+1</td>
                            </tr>
                            <tr>
                              <td class="border-end">&#8377; 1001 - &#8377; 2000</td>
                              <td>&#8377;<span class="usdt-price"></span>+2</td>
                            </tr>
                            <tr>
                              <td class="border-end">< &#8377;2001</td>
                              <td>&#8377;<span class="usdt-price"></span>+3</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="text-center mt-3">
            <button type="submit" class="btn btn-dark button-usdt" onclick="submitSell()">Next</button>
        </div>
        <p class="p-2 b3b3">In order to get your funds back better, faster, and more conveniently, your exchange order may be split into multiple parts.</p>
    </div>

    <script>
        var usdtPrice = 0;
    
        async function authenticate() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = "loginform.html";
                return false; // Return false if no token
            }
            const response = await fetch("https://onexcrypto.xyz/api/authUser", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                },
            });
            const result = await response.json();
            if (!result.success) {
                window.location.href = "loginform.html";
                return false; // Return false if authentication fails
            }
            return true; // Return true if authentication is successful
        }
    
        async function getUsdtprice() {
            const response = await fetch("https://onexcrypto.xyz/api/getUsdtPrice", {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                },
            });
            const data = await response.json();
            usdtPrice = data.price.usdtPrice;
            document.querySelectorAll(".usdt-price").forEach(element => {
                element.innerText = usdtPrice;
            });
        }
    
        async function submitSell() {
            const enteredAmount = parseFloat(document.getElementById('amountInput').value);
            const selectedNetwork = document.querySelector('input[name="network"]:checked');
            const availableBalance = document.getElementById('availableBalance').innerText;
    
            if (!selectedNetwork) {
                alert("Please select a network.");
                return;
            }
    
            if (enteredAmount <= 0 || enteredAmount > parseFloat(availableBalance.split(' ')[1])) {
                alert("Please enter a valid amount that does not exceed your available balance.");
                return;
            }
    
            const network = selectedNetwork.value;
            const rupeeAmount = parseFloat(document.getElementById('receivedAmount').innerText.split('₹')[1]);
            const txnPassword = document.getElementById('txnPassword').value;
    
            if (!txnPassword || !network || !rupeeAmount) {
                alert("Please fill in all the required fields.");
                return;
            }
    
            // Create payload for the POST request
            const payload = {
                usdtAmount: enteredAmount,
                rupeeAmount: rupeeAmount,
                network: network,
                transactionPassword: txnPassword
            };
    
            // Send POST request
            fetch('https://onexcrypto.xyz/api/sellCrypto', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                },
                body: JSON.stringify(payload),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message); // Show success message
                } else {
                    alert(`Error: ${data.message}`); // Show error message
                }
                window.location.href = 'user.html'; // Redirect to Exchange History page
            })
            .catch(error => {
                console.error('Error making sell request:', error);
                alert("An error occurred while processing your request.");
            });
        }
    
        document.addEventListener('DOMContentLoaded', async function () {
            const isAuthenticated = await authenticate();
            if (!isAuthenticated) {
                return; // Stop execution if not authenticated
            }
    
            // Fetch USDT price after authentication
            await getUsdtprice();
    
            fetch('https://onexcrypto.xyz/api/getUserDetails', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            })
            .then(response => response.json())
            .then(data => {
                const bankDetailsContainer = document.getElementById('bankDetailsContainer');
                const addBankAccountButton = document.getElementById('addBankAccountButton');
                const availableBalance = document.getElementById('availableBalance');
                const amountInput = document.getElementById('amountInput');
                const receivedAmount = document.getElementById('receivedAmount');
    
                let balanceBEP20 = parseFloat(data.userDetails.balances.bep20) || 0;
                let balanceTRC20 = parseFloat(data.userDetails.balances.trc20) || 0;
                let currentBalance = balanceBEP20; // Default to BEP-20
    
                if (data.userDetails.bankDetails) {
                    bankDetailsContainer.innerHTML = `
                        <p>Account Name: ${data.userDetails.bankDetails.accountHolderName}</p>
                        <p>Account Number: ${data.userDetails.bankDetails.accountNumber}</p>
                        <p>IFSC Code: ${data.userDetails.bankDetails.ifscCode}</p>
                    `;
                } else {
                    addBankAccountButton.style.display = 'block';
                }
    
                // Network Selection Handling
                const networkRadios = document.querySelectorAll('input[name="network"]');
                networkRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        if (radio.value === 'BSC') {
                            currentBalance = balanceBEP20;
                            availableBalance.innerText = `Available: ${currentBalance} BSC (BEP-20)`;
                        } else if (radio.value === 'TRX') {
                            currentBalance = balanceTRC20;
                            availableBalance.innerText = `Available: ${currentBalance} TRX (TRC-20)`;
                        }
                    });
                });
    
                // Calculate received amount on input change
                amountInput.addEventListener('input', function () {
                    const enteredAmount = parseFloat(amountInput.value) || 0;
    
                    if (enteredAmount > currentBalance) {
                        receivedAmount.innerText = `Amount exceeds available balance!`;
                        amountInput.classList.add('is-invalid');
                    } else {
                        let amountReceived = (enteredAmount * usdtPrice).toFixed(2);
                        if (enteredAmount * usdtPrice >= 500 && enteredAmount * usdtPrice <= 1000) {
                            amountReceived = (enteredAmount * (usdtPrice + 1)).toFixed(2);
                        } else if (enteredAmount * usdtPrice >= 1001 && enteredAmount * usdtPrice <= 2000) {
                            amountReceived = (enteredAmount * (usdtPrice + 2)).toFixed(2);
                        } else if (enteredAmount * usdtPrice > 2000) {
                            amountReceived = (enteredAmount * (usdtPrice + 3)).toFixed(2);
                        }
                        receivedAmount.innerText = `You will receive: ₹${amountReceived}`;
                        amountInput.classList.remove('is-invalid');
                    }
                });
            })
            .catch(error => {
                console.error('Error fetching user details:', error);
            });
        });
    </script>
    


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>
